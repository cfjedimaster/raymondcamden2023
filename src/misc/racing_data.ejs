---
permalink: /racing_data.json
---

<%
/*
We want an array of items that consist of date, category name, and # of posts. Bucket will contain that.
*/
bucket = [];

for(post of collections.posts) {
	// convert date to YYYY-MM-DD
	date = post.date.toISOString().split('T')[0];
	// convert to first of month, with timezones it ends up being the 2nd, but I just need it consistent
	date = new Date(date);
	date.setDate(1);
	year = date.getFullYear();
	month = date.getMonth();

	for(let cat of post.data.categories) {
		// do we have a bucket for year/month/cat
		existingBucket = bucket.findIndex(b => {
			return b.year === year && b.month === month && b.name === cat;
		});
		//console.log(`existingBucket for ${year}, ${month}, ${cat} is ${existingBucket}`);
		if(existingBucket === -1) {
			bucket.push({
				year, 
				month, 
				date:new Date(year,month,1),
				name:cat,
				value:0
			});
			existingBucket = bucket.length - 1;
		}
		bucket[existingBucket].value++;

	}

}
%>

<%- JSON.stringify(bucket) %>