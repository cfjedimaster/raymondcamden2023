---
layout: page
title: Now
description: 
body_class: page-template
---

<p>
Welcome to my Now page, representing the things I'm up to... well now. Below you'll find my books, music, films, and beer I'm either currently enjoying
or have finished. This page was last generated on {{ "now" | date: "%B %e, %Y" }}.
</p>

<h3>What I'm Reading</h3>

<div class="films">
{% for book in hardcover_books  %}
  <div class="film">
  {% if book.image != null %}
  <img src="https://res.cloudinary.com/raymondcamden/image/fetch/c_fit,w_216/{{book.image.url}}" alt="Cover of {{ book.title }}">
  {% endif %}
  "{{ book.title  }}" by {{ book.authors | join: ', ' }}
  </div>
{% endfor %}
</div>

<h3>What I'm Listening To</h3>

<p>
Here's my latest tracks from Spotify (pretty much the only way I listen to music). You can click on the album cover for a preview.
</p>

<div class="tracks">
<i>Loading...</i>
</div>

<h3>What I'm Watching</h3>

<p>
Ok, this is just movies, but here's what I've seen recently...
</p>

<div class="films">
{% for film in letterboxd_films limit:9 %}
	<div class="film">
	<a href="{{ film.link }}" target="_new"><img src="https://res.cloudinary.com/raymondcamden/image/fetch/c_fit,w_216/{{ film.image }}"></a>
	<a href="{{ film.link }}" target="_new">{{ film.name }}</a>
	</div>
{% endfor %}
</div>

<h3>My Latest Beers</h3>

<p>
I've been an <a href="https://untappd.com">Untappd</a> user for over a decade and while I'm drinking less beer lately (I've 
only started to drink wine in the last few years), I thought it would be cool to share my latest checkins. I only (typically) 
record *new* beers I've tried.
</p>

<ul>
{% for beer in untappd_beers limit:10 %}
<li><strong>{{ beer.name }}</strong> brewed by {{ beer.brewery }}. This is a {{ beer.style }} I gave {{ beer.rating }} stars out of 5.</li>
{% endfor %}
</ul>

<style>
.tracks, .films {
	display: grid;
	grid-template-columns: 33% 33% 33%;
}

.track, .film {
	border-style:solid;
	border-width:thin;
	padding: 10px; 
}

.track img {
	cursor: pointer;
	max-width: 100%;
}
</style>

<script>
// Endpoint to get my tracks
var TRACKS_API = 'https://eos6dxqdanfnilh.m.pipedream.net/';

document.addEventListener('DOMContentLoaded', init, false);

async function init() {

	let tracks = await getTracks();
	// while we get 20, limit to 18 as we're doing rows of 3
	tracks = tracks.slice(0, 18);

	let s = '';
	tracks.forEach(t => {

		let artists = t.artists.map(a => a.name).join(', ');

		let html = `
<div class="track">
<img src="${t.images[1].url}" data-preview="${t.preview_url}">
<a href="${t.href}" target="_new">"${t.name}"</a> by ${artists}
</div>
		`;
		s += html;

	});

	document.querySelector('.tracks').innerHTML = s;

	// add event listener for music preview
	let music = document.querySelectorAll('div.track img');
	let audio = new Audio();
	music.forEach(m => {
		m.addEventListener('click', e => {
			let preview = e.currentTarget.dataset.preview;
			if(audio.src) { 
				audio.pause(); 
				audio.currentTime = 0; 
				if(audio.src === preview) {
					audio.src = '';
					return;
				}
			}
			audio.src = preview;
			audio.play();
		});
	});
	audio.addEventListener('ended', e => { audio.src = '' });

}

async function getTracks() {
	/*
	I hit the TRACKS_API, but also cache - not that I think people will be hitting this much.
	I'll cache for 10 minutes. 
	*/
	let cache = sessionStorage.getItem('tracks');
	if(cache) {
		let cachedData = JSON.parse(cache);
		if(cachedData.tracks && cachedData.timestamp) {
			let now = new Date();
			let diff = (now.valueOf() - cachedData.timestamp) / (1000 * 60);
			console.log('age in minutes is', diff);
			if(diff < 10) return cachedData.tracks;
		}
	} 

	let resp = await fetch(TRACKS_API);
	let data = await resp.json();
	// cache it!
	cache = { tracks: data, timestamp:Date.now() };
	sessionStorage.setItem('tracks', JSON.stringify(cache));
	return data;
}
</script>